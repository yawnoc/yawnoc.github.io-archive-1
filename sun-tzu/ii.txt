<*>
  "[sun-tzu]'s Computational Classic: [vol-ii]": 《孫子算經\.卷中》
  | 20190609 | 20200225 | dmr
  | An annotated English translation of [vol-ii] of Sunzi Suanjing, \
    《孫子算經》, or "[sun-tzu]'s Computational Classic".
</*>

<=h>
  <@ih></@ih>
  <@it></@it>
  <@i> Paragraphs | #paragraphs | [paragraphs.h] </@i>
  <@ic></@ic>
</=h>

<h1>
  《孫子算經\.卷中》 \or \+
  "[sun-tzu]'s Computational Classic: [vol-ii]"
</h1>

<*p> |
  Also known as .[Sunzi Suanjing]: [vol-ii].
</*p>

<% [劉徽] | 劉徽 <^> Lau Fai | Liu Hui | Liu Hui </^> %>

<% [分] | 分 <^> fan | fe^n | fen </^> %>
<% [寸] | 寸 <^> ts'u"n | ts'un | cun </^> %>
<% [尺] | 尺 <^> ch'ek | ch'ih | chi </^> %>
<% [畝] | 畝 <^> mau | mu | mu </^> %>
<% [頃] | 頃 <^> k'ing | ch'ing | qing </^> %>

<% [斛] | 斛 <^> huk | hu | hu </^> %>


<@2> Volume navigation | volumes </@2>


<@@>
  <@d> Translation | translation </@d>
</@@>

<#n>
  
  <@>
    《孫子算經》 \or \+
    "[sun-tzu]'s Computational Classic"
    | /sun-tzu/
    | "[sun-tzu]'s Computational Classic": 《孫子算經》
  </@>
  ====
    <@i>
      《序》~"[pref]"
      | /sun-tzu/preface
      | "[sun-tzu-classic]": 《孫子算經\.序》
    </@i>
    <@i>
      《卷上》~"[vol-i]"
      | /sun-tzu/i
      | "[sun-tzu]'s Computational Classic: [vol-i]": 《孫子算經\.卷上》
    </@i>
  * 
      __《卷中》~"[vol-ii]" <:v>(incomplete)</:v>__
  
  * 
      <:r>\!《卷下》~"[vol-iii]"</:r>
      <:r>(haven't started)</:r>
  
  ====
  
</#n>

<% [sun-tzu] | Sun~Tzuu %>
<% [sun-tzu-classic] | [sun-tzu]'s Computational Classic %>
<% [pref] | Preface %>
<% [vol-i] | Volume~I %>
<% [vol-ii] | Volume~II %>
<% [vol-iii] | Volume~III %>

<%
  [version-a.url] |
  https://archive.org/details/02094034.cn/page/n
%>
<%
  [version-a.h] |
  02094034.cn at archive.org
%>

<%
  [version-b.url] |
  https://commons.wikimedia.org/w/index.php\
    ?title=File%3A%E6%96%87%E6%B7%B5%E9%96%A3%E5%9B%9B%\
      E5%BA%AB%E5%85%A8%E6%9B%B8_0797%E5%86%8A.djvu\
    &page=
%>
<%
  [version-b.h] |
  《文淵閣四庫全書》第0797冊 at Wikimedia Commons
%>

<%
  [version-c.url] |
  https://ctext.org/sunzi-suan-jing#n
%>
<%
  [version-c.h] |
  ctext.org database page
%>

<%
  [version-d.url] |
  https://ctext.org/library.pl?if=en&file=86926&page=
%>
<%
  [version-d.h] |
  《知不足齋叢書》本 at ctext.org library
%>

<-->
  <-t></-t>
  <-m></-m>
  path.step {
    fill: none;
    <-s></-s>
  }
  rect.border {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    vector-effect: non-scaling-stroke;
  }
  <-tc></-tc>
</-->

<% [mathit] | class="maths-italic" %>
<% [mathit-r] | class="maths-italic red" %>
<% [mathit-g] | class="maths-italic green" %>
<% [mathit-b] | class="maths-italic blue" %>
<% [mathit-v] | class="maths-italic violet" %>


<@2> Translation | translation </@2>


<@@>
  <@u> Volumes | volumes | Volume navigation </@u>
  <@d> Vol.~II Paragraphs | paragraphs | [paragraphs.h] </@d>
</@@>

<^^></^^>


<<
  《孫子算經\.卷中》
||
  "[sun-tzu]'s Computational Classic:
  [vol-ii]"
>>
----
  Literally "Middle Volume".
----

<% [paragraphs.h] | [vol-ii]: Paragraph navigation %>
<@3> [paragraphs.h] | paragraphs </@3>

<@@>
  <@u> Volumes | volumes | Volume navigation </@u>
</@@>

----
  __Note.__
  The <span class="heading">__"About" short headings__</span>
  are not part of the original text.
----

<!-- [__ __] for centred table cell -->
<% [__ | <td class="centred-text"> %>
<% __] | </td> %>

<!-- [== ==] for heading table cell -->
<% [== | <td class="heading"> %>
<% ==] | </td> %>

<!><table>
  <tr>
    <th>Link</th>
    <th class="heading">About</th>
  </tr>
  <tr>
    [__<@> \P1 | #1 | Vol. II \P1 </@>__]
    [==Reducing fractions==]
  </tr>
  <tr>
    [__<@> \P2 | #2 | Vol. II \P2 </@>__]
    [==Adding fractions==]
  </tr>
  <tr>
    [__<@> \P3 | #3 | Vol. II \P3 </@>__]
    [==Subtracting fractions==]
  </tr>
  <tr>
    [__<@> \P4 | #4 | Vol. II \P4 </@>__]
    [==Redistributing fractions for equality==]
  </tr>
  <tr>
    [__
      <@> \P5 | #5 | Vol. II \P5 </@>
      <@> \P6 | #6 | Vol. II \P6 </@>
      <@> \P7 | #7 | Vol. II \P7 </@>
      <@> \P8 | #8 | Vol. II \P8 </@>
    __]
    [==Volume conversions for grain==]
  </tr>
  <tr>
    [__<@> \P9 | #9 | Vol. II \P9 </@>__]
    [==Area of a rectangle==]
  </tr>
  <tr>
    [__<@> \P10 | #10 | Vol. II \P10 </@>__]
    [==Volume of a cylinder==]
  </tr>
  <tr>
    [__<@> \P11 | #11 | Vol. II \P11 </@>__]
    [==Volume of a rectangular prism==]
  </tr>
  <tr>
    [__<@> \P12 | #12 | Vol. II \P12 </@>__]
    [==Volume of a cylinder==]
  </tr>
  <tr>
    [__<@> \P13 | #13 | Vol. II \P13 </@>__]
    [==Area of a circle==]
  </tr>
  <tr>
    [__<@> \P14 | #14 | Vol. II \P14 </@>__]
    [==Area of a square of a given circumradius==]
  </tr>
  <tr>
    [__<@> \P15 | #15 | Vol. II \P15 </@>__]
    [==Dividing a cube into smaller cubes==]
  </tr>
  <tr>
    [__<@> \P16 | #16 | Vol. II \P16 </@>__]
    [==Side length of a square of a given perimeter==]
  </tr>
  <tr>
    [__<@> \P17 | #17 | Vol. II \P17 </@>__]
    [==Volume of a trapezoidal prism==]
  </tr>
  <tr>
    [__<@> \P18 | #18 | Vol. II \P18 </@>__]
    [==Volume of a rectangular prism==]
  </tr>
  <tr>
    [__
      <@> \P19 | #19 | Vol. II \P19 </@>
      <@> \P20 | #20 | Vol. II \P20 </@>
    __]
    [==Rod calculus: square root algorithm==]
  </tr>
</table></!>

<;sh> 2 | 1 | Reducing fractions </;sh>
<;s@@> 2 | 1 | 26 | 153 | 52130 | 1 | 39 </;s@@>

<<
  今有一十八分之一十二。問約之得幾何？ \+
  答曰：三分之二。
||
  Now there be twelve eighteenths.
  .[We] ask: how much resulteth, .[upon] reducing it? \+
  Answer saith: two thirds.
>>
====
* 一十八分之一十二：
    twelve eighteenths;
    \lit twelve of eighteen shares;
    \or twelve of eighteen portions

====

<<
  術曰：置十八分在下，一十二分在上。\
  副置二位，以少減多，等數得六為法，約之，即得。
||
  Method saith:
  put .[the] eighteen shares below,
  .[and the] twelve shares above.
  Put subsidiarily .[the] two places,
  .[and] diminish .[the] greater by .[the] lesser;
  .[for the] equal quantity .[there] resulteth six
  as .[the] divisor, .[and] reducing them, .[we] are done.
>>
====
* 副：
    subsidiarily

* 位：
    places

====

----
  Here we have the subtraction-only version of the Euclidean algorithm for
  greatest common divisor (gcd):
----
$$
  \begin{aligned}
    18 - 12 &= 6 \\
    12 - 6  &= 6
  \end{aligned}
$$

----
Therefore $\gcd (12, 18) = 6$ and we have
----
$$
  \frac{12}{18} = \frac{12 \div 6}{18 \div 6} = \frac{2}{3}.
$$

====
* 以少減多，等數得六：
    diminish .[the] greater by .[the] lesser.
    .[For the] equal quantity .[there] resulteth six \+
    In my opinion this description of the algorithm lacks clarity;
    there isn't any instruction here \
    to **repeat** the subtraction
    **until** you get the equal quantity~6.
    A better description is found in 《九章算術》,
    "Nine Chapters .[on] Computational Methods",
    in the chapter 〈方田〉, 'Rectangular Fields',
    which has the same problem of reducing
    <@>
      12/18
      | https://ctext.org/nine-chapters/fang-tian#n51071
      | 〈方田〉
    </@>, as well as
    <@>
      49/91
      | https://ctext.org/nine-chapters/fang-tian#n51073
      | 〈方田〉
    </@>.
    The <:y>bracketed portions</:y> below are inline two-column annotations by
    [劉徽], see the
    <@>
      《四部叢刊初編》
      | https://ctext.org/library.pl?if=en&file=77747&page=13
    </@>
    version. Punctuation for these <:y>bracketed annotations</:y> is mine:
    <<
      今有十八分之十二。問約之得幾何？ \+
      答曰：三分之二。
||
      Now there be twelve eighteenths.
      .[We] ask: how much resulteth, .[upon] reducing it? \+
      Answer saith: two thirds.
    >>
    <<
      又有九十一分之四十九。問約之得幾何？ \+
      答曰：十三分之七。
||
      Also there be forty-nine ninety-firsts.
      .[We] ask: how much resulteth, .[upon] reducing it? \+
      Answer saith: seven thirteenths.
    >>
    <<
      約分\
        （<:y>按：約分者，物之數量不可悉全，必以分言之。分之為數，繁則難用。\
        設有四分之二者。繁而言之，亦可為八分之四；約而言之，則二分之一也。\
        雖則異辭，至於為數，亦同歸爾。\
        法實相推，動有參差，故為術者，先治諸分。</:y>）\
      術曰：
||
      .[The] Method of Reducing Fractions
        (<:y>Note: Reducing Fractions---
        .[when a] number of objects cannot .[be] completely whole,
        .[we] must speak of them using fractions.
        .[A] fraction being .[a] quantity, .[if] complicated,
        .[is] difficult .[to] utilise.
        Suppose there be two fourths.
        Complicating .[it] in speaking of it,
        .[it] may also be four eighths;
        reducing .[it] in speaking of it, one half.
        Although different .[in their] terms,
        as to .[the] quantities .[they] are,
        .[these do] return .[the] same .[value].
        Divisors .[and] dividends .[in] calculation with each other,
        have unevenness .[in their] motions;
        therefore .[we] perform .[the] method,
        first administering it unto .[the] fractions.</:y>)
      saith:
    >>
    ====
    * 約：
        reducing;
        \or simplifying
    
    * 全：
        whole;
        \or intact
    
    * 動有參差：
        have unevenness .[in their] motions \+
        This is a literal rendering. I think
        [劉徽] is trying to say that
        different representations of fractions lead to inconsistencies
        (so first reduce them before doing any other calculations).
    
    * 諸 \+
        Contraction of 之於 (I think).
    
    ====
    <<
      可半者半之。\
      不可半者，副置分母、子之數，以少減多，更相減損，求其等也。\
      以等數約之。
      （<:y>等數約之，即除也。\
      其所以相減者，皆等數之重疊。故以等數約之。</:y>）
||
      those which can .[be] halved: halve them.
      Those which cannot .[be] halved: put subsidiarily
      .[the] quantities of .[the] denominator .[and the] numerator
      of .[the] fraction.
      Diminish .[the] greater by .[the] lesser, .[and]
      further subtract .[them] from each other,
      seeking their .[being] equal.
      Reduce them using .[the] equal quantity.
        (<:y>{To} reduce them .[with the] equal quantity,
        is .[to] divide .[them].
        Those of them which .[have been] mutually subtracted,
        .[are] all repeated pilings of .[the] equal quantity.
        Therefore .[we] use .[the] equal quantity
        .[to] reduce them.</:y>)
    >>
    ====
    * 重疊：
        repeated pilings;
        \or overlappings \+
        I think this means "multiples".
    
    ====

====

<;sh> 2 | 2 | Adding fractions </;sh>
<;s@@> 2 | 2 | 26 | 153 | 52133 | 2 | 39 </;s@@>

<<
  今有三分之一、五分之二。問合之二得幾何？ \+
  答曰：一十五分之一十一。
||
  Now there be one of three shares
  .[and] two of five shares.
  .[We] ask: how much resulteth, .[upon] joining them two? \+
  Answer saith: eleven of fifteen shares.
>>
====
* 
    <@> Version~C | [version-c.url]52133 | [version-c.h] </@>
    has only 合之 for 合之二.

* 
    <@> Version~B | [version-b.url]153 | [version-b.h] </@>
    has 十一 for 一十一.

* $b$ 分之 $a$:
    \lit $a$ of $b$ shares \+
    I have rendered fractions literally from here up to and including
    <@> \P4 | #4 | Vol. II \P4 </@>, as there will be references to
    the numerator 「之 $a$」, "$a$ of" and
    the denominator 「$b$ 分」, "$b$ shares"
    to follow.

====

<<
  術曰：置三分、五分在右方，之一、之二在左方。
||
  Method saith:
  put .[the] three shares .[and the] five shares
    on .[the] right;
  .[the] one of .[and the] two of,
    on .[the] left.
>>

<<
  母互乘子，五分之二得六，三分之一得五，并之，得一十一為實。\
  右方二母相乘，得一十五為法。
||
  .[The] denominators .[are]
  mutually multiplied with .[the] numerators:
  .[for the] two of five shares .[there] resulteth six,
  .[and for the] one of three shares
  .[there] resulteth five;
  combining them, resulteth in eleven as .[the] dividend.
  .[The] two denominators .[to the] right, multiplied with each other,
  result in fifteen as .[the] divisor.
>>
----
  In modern notation:
----
$$
  \frac{1}{3} + \frac{2}{5}
  = \frac{1 \times 5 + 2 \times 3}{3 \times 5}
  = \frac{11}{15}
$$

<<
  不滿法，以法命之，即得。
||
  .[The dividend] reacheth not .[the] divisor;
  naming it .[for a fraction] using .[the] divisor, .[we] are done.
>>
====
* 不滿法：
    .[The dividend] reacheth not .[the] divisor \+
    This is saying that 11~\<~15, i.e.~the fraction~11/15 is proper
    (so no further division is necessary).

====

<;sh> 2 | 3 | Subtracting fractions </;sh>
<;s@@> 2 | 3 | 28 | 153 | 52136 | 3 | 40 </;s@@>

<<
  今有九分之八，減其五分之一。問餘幾何？ \+
  答曰：四十五分之三十一。
||
  Now there be eight of nine shares,
  .[and we] diminish of it one of five shares.
  .[We] ask: how much remaineth? \+
  Answer saith: thirty-one of forty-five shares.
>>

<<
  術曰：置九分、五分在右方，之八、之一在左方。
||
  Method saith: put .[the] nine shares
  .[and the] five shares on .[the] right;
  .[the] eight of .[and the] one of,
  on .[the] left.
>>

<<
  母互乘子，五分之一得九，九分之八得四十，以少減多，餘三十一為實。\
  母相乘得四十五為法。
||
  .[The] denominators .[are] mutually multiplied
  with .[the] numerators:
  .[for the] one of five shares
    .[there] resulteth nine,
  .[and for the] eight of nine shares
    .[there] resulteth forty;
  diminishing .[the] greater by .[the] lesser,
  .[there] remaineth thirty-one as .[the] dividend.
  .[The] denominators multiplied with each other,
  result in forty-five as .[the] divisor.
>>
====
* 
    <@> Version~C | [version-c.url]52136 | [version-c.h] </@>
    erroneously has 王十一 for 三十一.

====
$$
  \frac{8}{9} - \frac{1}{5}
  = \frac{8 \times 5 - 1 \times 9}{9 \times 5}
  = \frac{31}{45}
$$

<<
  不滿法，以法命之，即得。
||
  .[The dividend] reacheth not .[the] divisor;
  naming it .[for a fraction] using .[the] divisor, .[we] are done.
>>

<;sh> 2 | 4 | Redistributing fractions for equality </;sh>
<;s@@> 2 | 4 | 28 | 153 | 52139 | 4 | 41 </;s@@>

<<
  今有三分之一、三分之二、四分之三。問減多益少，幾何而平？
||
  Now there be one of three shares,
  two of three shares .[and] three of four shares.
  .[We] ask: how much .[shall we] diminish .[the] greater
  .[to] benefit .[the] lesser, that .[they be] level?
>>
====
* 而平：
    that .[they be] level;
    \or that .[it be] fair

====

<<
  答曰：減四分之三者<:r>二</:r>，三分之二者<:v>一</:v>，\
  <:g>并</:g>以益三分之一，而各<:b>平於一十二分之七</:b>。
||
  Answer saith: that diminished of .[the] three of four shares,
  .[is] <:r>two</:r>;
  that of .[the] two of three shares, <:v>one</:v>;
  <:g>combined</:g> to benefit .[the] one of three shares,
  that each .[be] <:b>level at seven of twelve shares</:b>.
>>
$$
  \frac{3}{4} - {\colr \frac{2}{12}}
  = \frac{2}{3} - {\colv \frac{1}{12}}
  = \frac{1}{3} + \left( \colg \frac{2}{12} + \frac{1}{12} \right)
  = {\colb \frac{7}{12}}
$$

----
  More generally, consider redistributing the fractions
  $a/A$, $b/B$ and $c/C$ for equality.
  Their mean is
----
$$
  m = \frac{L}{3 ABC},
$$
----
where
----
$$
  L = aBC + bCA + cAB,
$$
----
  so the fractions must be changed by the quantities
----
$$
  m - \left( \frac{a}{A}, \frac{b}{B}, \frac{c}{C} \right)
  = \frac{L - (3 aBC, 3 bCA, 3 cAB)}{3 ABC}
$$
----
  respectively.
  Of course [sun-tzu]
  did not have the luxury of modern mathematical notation:
----

<<
  術曰：置三分、三分、四分在右方，之一、之二、之三在左方。\
  母互乘子，副并得六十三，置右為平實。
||
  Method saith: put .[the] three shares,
  .[the] three shares .[and the] four shares
  on .[the] right;
  .[the] one of, .[the] two of .[and the]
  three of, on .[the] left.
  .[The] denominators, mutually multiplied with .[the] numerators,
  combined subsidiarily, result in sixty-three,
  put to .[the] right as .[the] level dividend.
>>
====
* 
    <@> Version~C | [version-c.url]52139 | [version-c.h] </@>
    erroneously has 母互乘于 for 母互乘子.

* 平實：
    level dividend \+
    $L = aBC + bCA + cAB = 63$.

====
$$
  \begin{alignedat}{3.5}
    a &= 1 \qquad & A &= 3 \qquad & aBC &= 12 \\
    b &= 2 \qquad & B &= 3 \qquad & bCA &= 24 \\
    c &= 3 \qquad & C &= 4 \qquad & cAB &= 27 \\ \hline
      &           &   &           &   L &= 63
  \end{alignedat}
$$

<<
  母相乘，得三十六為法。
||
  .[The] denominators multiplied with each other,
  result in thirty-six as .[the] divisor.
>>
$$
  ABC = 3 \times 3 \times 4 = 36
$$

<<
  以列數三乘未并者及法。
||
  Multiply those not yet combined, and .[the] divisor,
  by .[the] number of rows, three.
>>
====
* 未并者：
    those not yet combined \+
    These are the individual terms $aBC$, $bCA$ and $cAB$,
    before they were combined subsidiarily to make the level dividend $L$.

====

$$
  \begin{aligned}
    3 aBC &= 36 \\
    3 bCA &= 72 \\
    3 cAB &= 81 \\
    3 ABC &= 108
  \end{aligned}
$$

<<
  等數得九，約訖。
||
  .[For their] equal quantity .[there] resulteth nine;
  finish reducing .[them].
>>
====
* 等數：
    equal quantity \+
    Greatest common divisor (gcd) is called an "equal quantity"
    because it is determined by repeated subtraction until an equal quantity
    is obtained, see <@> \P1 | #1 | Vol. II \P1 </@>.

====

$$
  \gcd (L, 3 aBC, 3 bCA, 3 cAB, 3 ABC) = 9
$$

----
Therefore
----
$$
  \begin{aligned}
    \frac{L - (3 aBC, 3 bCA, 3 cAB)}{3 ABC}
    &= \frac{63 \div 9 - (36, 72, 81) \div 9}{108 \div 9} \\[2ex]
    &= \frac{7 - (4, 8, 9)}{12} \\[2ex]
    &= \frac{(+3, -1, -2)}{12}.
  \end{aligned}
$$

<<
  減四分之三者二，減三分之二者一，并以益三分之一，各平於一十二分之七。
||
  That diminished of .[the] three of four shares,
  .[is] two;
  that diminished of .[the] two of three shares, one;
  combined to benefit .[the] one of three shares,
  each level at seven of twelve shares.
>>

<;sh> 2 | 5 | Volume conversions for grain </;sh>
<;s@@> 2 | 5 | 30 | 153 | 52142 | 5 | 42 </;s@@>

<<
  今有粟一斗。問為糲米幾何？ \+
  答曰：六升。
||
  Now there be grain, one peck.
  .[We] ask: how much be .[this in] coarse grain? \+
  Answer saith: six quarts.
>>
====
* 
    <@> Version~C | [version-c.url]52142 | [version-c.h] </@>
    erroneously has 糯米 for 糲米.

====

<<
  術曰：置粟一斗，十升。\
  以糲米率三十乘之，得三百升為實。以粟率五十為法，除之，即得。
||
  Method saith: put .[down the] grain,
  one peck, .[or] ten quarts.
  Multiplying it by .[the] coarse grain rate, thirty,
  resulteth in three hundred quarts
  as .[the] dividend.
  Use .[the] grain rate, fifty, as .[the] divisor,
  .[and] dividing them, .[we] are done.
>>
----
  In modern notation, with $V$ for volume and $r$ for rate:
----
$$
  \begin{aligned}
    V(\text{sought})
    &=
    \frac{
      V(\text{there be}) \cdot r(\text{sought})
    }{
      r(\text{there be})
    } \\[2ex]
    &= \frac{10 \unit{quarts} \times 30}{50} \\[2ex]
    &= 6 \unit{quarts}
  \end{aligned}
$$
====
* 
    Here we have cross-multiplication, known as 今有術,
    the 'now there be method',
    see the chapter
    <@>
      〈粟米〉, 'Grain'
      | https://ctext.org/nine-chapters/su-mi
      | 〈粟米〉
    </@>, of 《九章算術》,
    "Nine Chapters .[on] Computational Methods",
    which gives a list of 率, rates, for common grains.
    (Note that the ctext database's version has transcription errors;
    see instead the
    <@>
      《四部叢刊初編》
      | https://ctext.org/library.pl?if=en&file=77747&page=54
    </@>
    version).
    The portion thereof which is relevant to this paragraph~(\P5) through~\P8:
    <<
      粟米之法：\
      粟率五十；\
      糲米三十；\
      粺米二十七；\
      糳米二十四；\
      御米二十一；……
||
      .[The] method of grain:
      .[the] grain rate .[is] fifty;
      coarse grain, thirty;
      fine grain, twenty-seven;
      intricate grain, twenty-four;
      poppy seed, twenty-one; ...
    >>
    <<
      今有術曰：以所有數乘所求率為實，以所有率為法，實如法而一。
||
      .[The] 'now there be' method saith:
      use .[the] quantity of that there be,
      times .[the] rate of that sought,
      as .[the] dividend,
      .[and] use .[the] rate of that there be,
      as .[the] divisor.
      .[Take the] dividend, as .[if the] divisor .[were] one.
    >>

====

<;sh> 2 | 6 | Volume conversions for grain </;sh>
<;s@@> 2 | 6 | 30 | 153 | 52145 | 6 | 42 </;s@@>

<<
  今有粟二斗一升。問為粺米幾何？ \+
  答曰：一斗一升五十分升之一十七。
||
  Now there be grain, two pecks .[and] one quart.
  .[We] ask: how much be .[this in] fine grain? \+
  Answer saith:
    one peck, one quart .[and]
    seventeen fiftieths of .[a] quart.
>>
====
* 
    <@> Version~C | [version-c.url]52145 | [version-c.h] </@>
    erroneously has 稗 for 粺, both here and below.

* 粺：
    fine grain \+
      粺，
      Cantonese:
      《分韻撮要》 p'ei4;
      《正韻》薄邁切, paai6,
      Mandarin: ba\i

* 五十分升之一十七：
    \lit seventeen of fifty shares
    of .[a] quart

====

<<
  術曰：置粟二十一升。以粺米率二十七乘之，得五百六十七升為實。\
  以粟率五十為法，除之。不盡，以法而命分。
||
  Method saith: put .[down the] grain,
  twenty-one quarts.
  Multiplying it by .[the] fine grain rate, twenty-seven,
  resulteth in five hundred .[and] sixty-seven quarts
  as .[the] dividend.
  Use .[the] grain rate, fifty, as .[the] divisor,
  .[and] divide them.
  .[For the] remainder, name .[the] fraction using .[the] divisor.
>>
$$
  V
  = \frac{21 \unit{quarts} \times 27}{50}
  = 11 \tfrac{17}{50} \unit{quarts}
$$

<;sh> 2 | 7 | Volume conversions for grain </;sh>
<;s@@> 2 | 7 | 30 | 154 | 52148 | 7 | 43 </;s@@>

<<
  今有粟四斗五升。問為糳米幾何？ \+
  答曰：二斗一升五分升之三。
||
  Now there be grain, four pecks .[and] five quarts.
  .[We] ask: how much be .[this in] intricate grain? \+
  Answer saith:
    two pecks, one quart .[and]
    three fifths of .[a] quart.
>>
====
* 
    <@> Version~C | [version-c.url]52148 | [version-c.h] </@>
    erroneously has 槃 for 糳, both here and below.

====

<<
  術曰：置粟四十五升。以二約糳米率二十四，得一十二，乘之，得五百四十升為實。
||
  Method saith: put .[down the] grain, forty-five quarts.
  Reducing .[the] intricate grain rate, twenty-four,
  by two, resulteth in twelve;
  multiplying them resulteth in five hundred .[and] forty quarts
  as .[the] dividend.
>>
====
* 以二約：
    reducing by two \+
    The intricate grain rate~24 here and the (normal) grain rate~50 below
    are reduced by their greatest common divisor, $\gcd (24, 50) = 2$.

====

<<
  以二約粟率五十，得二十五為法。除之。不盡，以等數約之，而命分。
||
  Reducing .[the] grain rate, fifty,
  by two, resulteth in twenty-five as .[the] divisor.
  Divide them.
  .[For the] remainder, reduce it by .[the] equal quantity,
  and name .[the] fraction.
>>
====
* 不盡，以等數約之：
    .[for the] remainder, reduce it by .[the] equal quantity \+
    The division 540~÷~25 leaves remainder 15/25.
    Their "equal quantity" (see <@> \P1 | #1 | Vol. II \P1 </@>)
    is $\gcd (15, 25) = 5$, by which the fraction is reduced to~3/5.

====

$$
  V
  = \frac{45 \unit{quarts} \times 24 \div 2}{50 \div 2}
  = 21 \tfrac{3}{5} \unit{quarts}
$$

<;sh> 2 | 8 | Volume conversions for grain </;sh>
<;s@@> 2 | 8 | 30 | 154 | 52151 | 8 | 44 </;s@@>

<<
  今有粟七斗九升。問為御米幾何？ \+
  答曰：三斗三升一合八勺。
||
  Now there be grain, seven pecks .[and] nine quarts.
  .[We] ask: how much be .[this in] poppy seed? \+
  Answer saith:
    three pecks,
    three quarts,
    one gill .[and]
    eight ladles.
>>
====
* 
    <@> Version~C | [version-c.url]52148 | [version-c.h] </@>
    erroneously has 栗 for 粟.

* 御米：
    poppy seed;
    \lit imperial grain;
    \or royal grain

====

<<
  術曰：置七斗九升。\
  以御米率二十一乘之，得一千六百五十九升為實。以粟率五十除之，即得。
||
  Method saith: put .[down the]
    seven pecks .[and]
    nine quarts.
  Multiplying it by .[the] poppy seed rate, twenty-one,
  resulteth in one thousand, six hundred .[and] fifty-nine quarts
  as .[the] dividend.
  Dividing it by .[the] grain rate, fifty,
  .[we] are done.
>>
$$
  V
  = \frac{79 \unit{quarts} \times 21}{50}
  = 33.18 \unit{quarts}
$$

<;sh> 2 | 9 | Area of a rectangle </;sh>
<;s@@> 2 | 9 | 32 | 154 | 52154 | 9 | 44 </;s@@>

<<
  今有屋基，南北三丈，東西六丈，欲以甎砌之。凡積二尺，用甎五枚。問計幾何？
||
  Now there be .[an] house foundation,
    three rods north-{to}-south, .[and]
    six rods east-{to}-west,
  .[and we] wish to build it with bricks.
  Every two rules of area,
  useth five bricks.
  .[We] ask: how many amounteth .[this] to?
>>
====
* 南北：
    north-{to}-south;
    \lit south-{to}-north

* 
    <@> Version~C | [version-c.url]52154 | [version-c.h] </@>
    erroneously has ●~(<code>U+25CF</code>)
    for both instances of 甎.

* 枚 \+
    Classifier for bricks, omitted in the English.

====

<<
  答曰：四千五百枚。
||
  Answer saith: four thousand five hundred .[bricks].
>>

<<
  術曰：置東西六丈，以南北三丈乘之，得一千八百尺。\
  以五乘之，得九千尺。以二除之，即得。
||
  Method saith: put .[down the]
    six rods east-{to}-west.
  Multiplying it by .[the]
    three rods north-{to}-south,
  resulteth in one thousand eight hundred rules.
  Multiplying it by five, resulteth in
  nine thousand rules.
  Dividing it by two, .[we] are done.
>>
====
* 九千尺：
    nine thousand rules \+
    This is area, but what we would call "square rules"
    were simply referred to as "rules".

====

----
  In modern notation, the number of bricks required to fill
  a rectangle of length $L = 3 \unit{rods}$
  and width $W = 6 \unit{rods}$
  at number density $\rho = 5 / (2 \unit{rules}^2)$ is
----
$$
  \begin{aligned}
    N
    &= L W \rho \\
    &= 3 \unit{rods} \times 6 \unit{rods} \times \frac{5}{2 \unit{rules}^2} \\
    &= 4500.
  \end{aligned}
$$

<;sh> 2 | 10 | Volume of a cylinder </;sh>
<;s@@> 2 | 10 | 32 | 154 | 52157 | 10 | 45 </;s@@>

<<
  今有圓窖，下周二百八十六尺，深三丈六尺。問受粟幾何？
||
  Now there be .[a] circular cellar, of lower circumference
  two hundred .[and] eighty-six rules,
  .[and] depth three rods .[and] six rules.
  .[We] ask: how much grain beareth .[it]?
>>
====
* 窖：地藏也；
    cellar \+
    窖，居效切，
    <^cm> kaau3 | jia\o </^cm>

====

<<
  答曰：一十五萬一千四百七十四斛七升二十七分升之一十一。
||
  Answer saith: one hundred .[and] fifty-one thousand,
  four hundred .[and] seventy-four barrels,
  seven quarts
  .[and] eleven twenty-sevenths of .[a] quart.
>>

<<
  術曰：置周二百八十六尺，自相乘，得八萬一千七百九十六尺。
||
  Method saith: put .[down the] circumference,
  two hundred .[and] eighty-six rules, .[which],
  multiplied with itself, resulteth in
  eighty-one thousand, seven hundred .[and] ninety-six rules.
>>

<<
  以深三丈六尺乘之，得二百九十四萬四千六百五十六尺。
||
  Multiplying it by .[the] depth,
  three rods .[and] six rules,
  resulteth in two million, nine hundred .[and] forty-four thousand,
  six hundred .[and] fifty-six rules.
>>
====
* 
    Only
    <@> Version~C | [version-c.url]52157 | [version-c.h] </@>
    has 尺 at the end of this sentence.

====

<<
  以一十二除之，得二十四萬五千三百八十八尺。
||
  Dividing it by twelve, resulteth in
  two hundred .[and] forty-five thousand, three hundred .[and]
  eighty-eight rules.
>>

<<
  以斛法一尺六寸二分除之，即得。
||
  Dividing it by .[the] barrel divisor,
    one rule, six inches .[and] two tenths,
  .[we] are done.
>>
====
* 斛法一尺六寸二分：
    .[the] barrel divisor,
      one rule, six inches .[and] two tenths \+
    The "barrel divisor" gives the conversion between
    the volume unit cubic rule~([尺])
    and the capacity unit barrel~([斛]).
    In modern (dimensionally consistent) notation, we would write
    $$
      1 = \frac{1.62 \unit{rules}^3}{\unit{barrel}}.
    $$
    Recall the Chinese did not have a fully developed notion
    of dimensional analysis, so "square rules"
    and "cubic rules" were simply referred to as "rules"
    (though they still knew how to do area and volume conversions correctly).
    Here,
      "one rule, six inches .[and] two tenths",
    which is the length "1.62~rules",
    actually means the volume 1.62~**cubic**~rules.
    But
      $$
        \begin{aligned}
          1.62 \unit{rules}^3
          &=
            (1 \unit{rule} + 6 \unit{inches} + 2 \unit{tenths})
              \cdot
            1 \unit{rule}^2 \\
          &= 1 \unit{rule}^3 + 600 \unit{inches}^3 + 20000 \unit{tenths}^3 \\
          &\ne 1 \unit{rule}^3 + 6 \unit{inches}^3 + 2 \unit{tenths}^3,
        \end{aligned}
      $$
    so parsing
      rule~([尺]),
      inch~([寸]) and
      tenth~([分])
    individually as cubic units doesn't make sense.

====

----
  In modern notation, the volume (capacity) of a cylinder of circumference
  $C = 286 \unit{rules}$ and depth $H = 36 \unit{rules}$ is
----
$$
\begin{aligned}
  V
  &\approx \frac{C^2 H}{12} \\[2ex]
  &=
    \frac{(286 \unit{rules})^2 (36 \unit{rules})}{12}
      \div
    \frac{1.62 \unit{rules}^3}{\unit{barrel}} \\[2ex]
  &= 151474 \tfrac{2}{27} \unit{barrels} \\
  &= 151474 \unit{barrels} + 7 \tfrac{11}{27} \unit{quarts}.
\end{aligned}
$$

----
  Here $\pi \approx 3$ (so that $4\pi \approx 12$), see
  <@> Vol.~I \P5 | /sun-tzu/i#5 | Vol. I \P5 </@>.
----

<;sh> 2 | 11 | Volume of a rectangular prism </;sh>
<;s@@> 2 | 11 | 34 | 154 | 52160 | 11 | 46 </;s@@>

<<
  今有方窖，廣四丈六尺，長五丈四尺，深三丈五尺。問受粟幾何？
||
  Now there be .[a] rectangular cellar,
  of width four rods .[and] six rules,
  length five rods .[and] four rules,
  .[and] depth three rods .[and] five rules.
  .[We] ask: how much grain beareth .[it]?
>>

<<
  答曰：五萬三千六百六十六斛六斗六升三分升之二。
||
  Answer saith:
  fifty-three thousand, six hundred .[and] sixty-six barrels,
  six pecks,
  six quarts
  .[and] two thirds of .[a] quart.
>>
====
* 
    <@> Version~A | [version-a.url]34 | [version-a.h] </@>
    and
    <@> Version~D | [version-d.url]46 | [version-d.h] </@>
    erroneously have 三分升之一 for 三分升之二.

====

<<
  術曰：置廣四丈六尺、長五丈四尺，相乘，得二千四百八十四尺。
||
  Method saith: put .[down the] width,
    four rods .[and] six rules,
  .[and the] length,
    five rods .[and] four rules,
  .[which], multiplied with each other,
  result in two thousand, four hundred .[and] eighty-four rules.
>>

<<
  以深三丈五尺乘之，得八萬六千九百四十尺。
||
  Multiplying it by .[the] depth,
    three rods .[and] five rules,
  resulteth in
    eighty-six thousand, nine hundred .[and] forty rules.
>>

<<
  以斛法一尺六寸二分除之，即得。
||
  Dividing it by .[the] barrel divisor,
    one rule, six inches .[and] two tenths,
  .[we] are done.
>>

----
  In modern notation, the volume (capacity) of a rectangular prism of
  width $W = 46 \unit{rules}$, length $L = 54 \unit{rules}$ and
  depth $H = 35 \unit{rules}$ is
----
$$
  \begin{aligned}
    V
    &= W L H \\
    &=
      46 \unit{rules} \times 54 \unit{rules} \times 35 \unit{rules}
        \div
      \frac{1.62 \unit{rules}^3}{\unit{barrel}} \\[2ex]
    &= 53666 \tfrac{2}{3} \unit{barrels} \\
    &= 53666 \unit{barrels} + 6 \unit{pecks} + 6 \tfrac{2}{3} \unit{quarts}.
  \end{aligned}
$$

<;sh> 2 | 12 | Volume of a cylinder </;sh>
<;s@@> 2 | 12 | 34 | 154 | 52163 | 12 | 47 </;s@@>

<<
  今有圓窖，周五丈四尺，深一丈八尺。問受粟幾何？
||
  Now there be .[a] circular cellar, of circumference
    five rods .[and] four rules,
  .[and] depth
    one rod .[and] eight rules.
  .[We] ask: how much grain beareth .[it]?
>>

<<
  答曰：二千七百斛。
||
  Answer saith:
  two thousand seven hundred barrels.
>>

<<
  術曰：先置周五丈四尺，自相乘，得二千九百一十六尺。
||
  Method saith: First put .[down the] circumference,
    five rods .[and] four rules,
  .[which], multiplied with itself, resulteth in
  two thousand, nine hundred .[and] sixteen rules.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]34 | [version-a.h] </@>,
    <@>
      B | [version-b.url]154 | [version-b.h] </@>
    and~\
    <@>
      D | [version-d.url]47 | [version-d.h] </@>
    are erroneously missing 自 in 自相乘.

====

<<
  以深一丈八尺乘之，得五萬二千四百八十八尺。
||
  Multiplying it by .[the] depth,
    one rod .[and] eight rules,
  resulteth in
    fifty-two thousand, four hundred .[and] eighty-eight rules.
>>

<<
  以一十二除之，得四千三百七十四尺。
||
  Dividing it by twelve, resulteth in
    four thousand, three hundred .[and] seventy-four rules.
>>

<<
  以斛法一尺六寸二分除之，即得。
||
  Dividing it by .[the] barrel divisor,
    one rule, six inches .[and] two tenths,
  .[we] are done.
>>

----
  In modern notation, the volume (capacity) of a cylinder of circumference
  $C = 54 \unit{rules}$ and depth $H = 18 \unit{rules}$ is
----
$$
  \begin{aligned}
    V
    &\approx \frac{C^2 H}{12} \\[2ex]
    &=
      \frac{(54 \unit{rules})^2 (18 \unit{rules})}{12}
        \div
      \frac{1.62 \unit{rules}^3}{\unit{barrel}} \\[2ex]
    &= 2700 \unit{barrels}.
  \end{aligned}
$$
----
  Here $\pi \approx 3$ (so that $4\pi \approx 12$), see
  <@> Vol.~I \P5 | /sun-tzu/i#5 | Vol. I \P5 </@>.
----

<;sh> 2 | 13 | Area of a circle </;sh>
<;s@@> 2 | 13 | 34 | 155 | 52166 | 13 | 48 </;s@@>

<<
  今有圓田，周三百步，徑一百步。問得田幾何？
||
  Now there be .[a] circular field, of circumference
    three hundred paces,
  .[and] diameter
    one hundred paces.
  .[We] ask: how much field resulteth?
>>
----
  Here $\pi \approx 3$, see
  <@> Vol.~I \P5 | /sun-tzu/i#5 | Vol. I \P5 </@>.
----

<<
  答曰：三十一畝奇六十步。
||
  Answer saith: thirty-one acres,
  remainder sixty paces.
>>
====
* 奇：
    remainder \+
    奇，音羈，
    <^cm> kei1 | ji= </^cm> \+
    To convert area from square paces
    to acres, [畝],
    one divides by the conversion factor
      $240 \unit{paces}^2 / \unit{acre}$
    (called the "acre divisor" below).
    This is why answer saith refers to a "remainder".

====
----
  In modern notation, the area is $31 \unit{acres} + 60 \unit{paces}^2$.
----

<<
  術曰：先置周三百步，半之，得一百五十步。又置徑一百步，半之，得五十步。\
  相乘，得七千五百步。
||
  Method saith: first put .[down the] circumference,
    three hundred paces;
  halving it, resulteth in
    one hundred .[and] fifty paces.
  Also put .[down the] diameter,
    one hundred paces;
  halving it, resulteth in
    fifty paces.
  .[These], multiplied with each other, result in
    seven thousand five hundred paces.
>>

<<
  以畝法二百四十步除之，即得。
||
  Dividing it by .[the] acre divisor,
    two hundred .[and] forty paces,
  .[we] are done.
>>

<<
  又術：周自相乘，得九萬步。以一十二除之，得七千五百步。
||
  Also .[a] method: .[the] circumference, multiplied with itself,
  resulteth in ninety thousand paces.
  Dividing it by twelve, resulteth in
    seven thousand five hundred paces.
>>
====
* 
    <@> Version~B | [version-b.url]155 | [version-b.h] </@>
    has 又術曰 for 又術, both here and below.

====

<<
  以畝法除之，得畝數。
||
  Dividing it by .[the] acre divisor,
  resulteth in .[the] number of acres.
>>

<<
  又術：徑自乘，得一萬。以三乘之，得三萬步。四除之，得七千五百步。
||
  Also .[a] method: .[the] diameter, multiplied .[with] itself,
  resulteth in ten thousand.
  Multiplying it by three, resulteth in
    thirty thousand paces.
  Dividing it .[by] four, resulteth in
    seven thousand five hundred paces.
>>

<<
  以畝法除之，得畝數。
||
  Dividing it by .[the] acre divisor,
  resulteth in .[the] number of acres.
>>
----
  In modern notation (and taking $\pi \approx 3$),
  a circle with circumference $C$ and diameter $d$ has area
----
$$
  \frac{C}{2} \cdot \frac{d}{2} \approx \frac{C^2}{12} \approx \frac{3d^2}{4}.
$$

<;sh> 2 | 14 | Area of a square of a given circumradius </;sh>
<;s@@> 2 | 14 | 36 | 155 | 52171 | 14 | 49 </;s@@>

<<
  今有方田，桑生中央。從角至桑一百四十七步。問為田幾何？
||
  Now there be .[a] square field,
  .[with a] mulberry tree growing .[in the] centre.
  From .[a] corner unto .[the] mulberry tree:
    one hundred .[and] forty-seven paces.
  .[We] ask: how much field be .[this]?
>>

<<
  答曰：一頃八十三畝奇一百八十步。
||
  Answer saith:
    one yardland .[and]
    eighty-three acres,
    remainder one hundred .[and] eighty paces.
>>
====
* [頃]：
    yardland \+
    100 Chinese acres.
    Difficult to render, and I have chosen "yardland"
    because it sounds more natural,
    even though the
    <@>
      imperial oxgang
      | https://en.wikipedia.org/wiki/Oxgang
      | Wikipedia: Oxgang
    </@>
    (which is only half an
    <@>
      imperial yardland or virgate
      | https://en.wikipedia.org/wiki/Virgate
      | Wikipedia: Virgate
    </@>)
    is closer in size.

====

<<
  術曰：置角至桑一百四十七步，倍之，得二百九十四步。
||
  Method saith: put .[down the] corner unto .[the] mulberry tree,
    one hundred .[and] forty-seven paces.
  Doubling it, resulteth in
    two hundred .[and] ninety-four paces.
>>

<<
  以五乘之，得一千四百七十步。\
  以七除之，得二百一十步，自相乘，得四萬四千一百步。
||
  Multiplying it by five, resulteth in
    one thousand four hundred .[and] seventy paces.
  Dividing it by seven, resulteth in
    two hundred .[and] ten paces,
  .[which], multiplied with itself, resulteth in
    forty-four thousand, one hundred paces.
>>

<<
  以二百四十步除之，即得。
||
  Dividing it by two hundred .[and] forty paces,
  .[we] are done.
>>
----
  In modern notation, the area of a square with circumradius (or semi-diagonal)
  $s = 147 \unit{paces}$ is
----
$$
  \begin{aligned}
    A
    &\approx \left( 2s \cdot \frac{5}{7} \right)^2 \\[2ex]
    &=
      \left( 2 \times 147 \unit{paces} \times \frac{5}{7} \right)^2
        \div
      \frac{240 \unit{paces}^2}{\unit{acre}} \\[2ex]
    &= 183 \unit{acres} + 180 \unit{paces}^2 \\
    &= 1 \unit{yardland} + 83 \unit{acres} + 180 \unit{paces}^2.
  \end{aligned}
$$
----
  Here $\sqrt{2} \approx 7/5$, see
  <@> Vol.~I \P5 | /sun-tzu/i#5 | Vol. I \P5 </@>.
----


<;sh> 2 | 15 | Dividing a cube into smaller cubes </;sh>
<;s@@> 2 | 15 | 36 | 155 | 52174 | 15 | 49 </;s@@>

<<
  今有木方三尺，欲方五寸作枕一枚。問得幾何？
||
  Now there be .[a] wooden cube .[of edge] three rules,
  .[and we] wish .[that each] cube .[of edge] five inches .[thereof be]
  made into one pillow.
  .[We] ask: how many result?
>>
====
* 
    <@> Version~B | [version-b.url]155 | [version-b.h] </@>
    and
    <@> Version~C | [version-c.url]52174 | [version-c.h] </@>
    have 高三尺 after 木方三尺.

* 枚 \+
    Classifier, omitted in the English.

====

<<
  答曰：二百一十六枚。
||
  Answer saith: two hundred .[and] sixteen .[pillows].
>>

<<
  術曰：置方三尺，自相乘，得九尺。以高三尺乘之，得二十七尺。
||
  Method saith: put .[down the] cube's .[edge], three rules,
  .[which], multiplied with itself, resulteth in nine rules.
  Multiplying it by .[the] height, three rules,
  resulteth in twenty-seven rules.
>>

<<
  以一尺木八枕乘之，即得。
||
  Multiplying it by eight pillows .[for each]
    one rule of wood,
  .[we] are done.
>>
====
* 一尺：
    one rule \+
    This is a **cubic** rule,
    as are the 27~rules above.

====
----
  In modern notation, the number of pillows is
----
$$
  (3 \unit{rules})^3 \times \frac{8}{1 \unit{rule}^3} = 216,
$$
----
  where we have used the fact that
  $1 \unit{rule} = 2 \times 5 \unit{inches}$,
  and that $2^3 = 8$.
----

<;sh> 2 | 16 | Side length of a square of a given perimeter </;sh>
<;s@@> 2 | 16 | 38 | 155 | 52177 | 16 | 50 </;s@@>

<<
  今有索長五千七百九十四步，欲使作方。問幾何？ \+
  答曰：一千四百四十八步三尺。
||
  Now there be rope, of length
    five thousand, seven hundred .[and] ninety-four paces,
  .[and we] wish to make .[it] be .[a] square.
  .[We] ask: how much .[be its edge]? \+
  Answer saith:
    one thousand, four hundred .[and] forty-eight paces
    .[and] three rules.
>>

<<
  術曰：置索長五千七百九十四步。以四除之，得一千四百四十八步，餘二步。
||
  Method saith: put .[down the] rope's length,
    five thousand, seven hundred .[and] ninety-four paces.
  Dividing it by four, resulteth in
    one thousand, four hundred .[and] forty-eight paces,
    remainder two paces.

>>
<<
  以六因之，得一丈二尺。以四除之，得三尺。
||
  Multiplying it by six, resulteth in
    one rod .[and] two rules.
  Dividing it by four, resulteth in
    three rules.
>>
====
* 因：
    multiplying \+
    As in times tables, 九因歌, "{the} Song of Nine Multiples".

====

<<
  通計，即得。
||
  Computing .[the] total, .[we] are done.
>>
====
* 通：總也；
    total

====

----
  In modern notation, the side length of the square is
----
$$
  \begin{aligned}
    \frac{5794 \unit{paces}}{4}
    &=
      1448 \unit{paces}
        +
      \frac{2 \unit{paces}}{4}
        \times
      \frac{6 \unit{rules}}{\unit{pace}} \\[2ex]
    &= 1448 \unit{paces} + 3 \unit{rules}.
  \end{aligned}
$$


<;sh> 2 | 17 | Volume of a trapezoidal prism </;sh>
<;s@@> 2 | 17 | 38 | 155 | 52180 | 17 | 51 </;s@@>

<<
  今有隄，下廣五丈，上廣三丈，高二丈，長六十尺，欲以一千尺作一方。問計幾何？
||
  Now there be .[an] embankment, of
    lower width five rods,
    upper width three rods,
    height two rods, .[and]
    length sixty rules,
  .[and we] wish to consider
    one thousand rules
  as one block.
  .[We] ask: how many amounteth .[this] to?
>>
====
* 一千尺：
    one thousand rules \+
    These are **cubic** rules.

====

<<
  答曰：四十八方。
||
  Answer saith: forty-eight blocks.
>>

<<
  法曰：置隄上廣三丈、下廣五丈。并之，得八丈。半之，得四丈。
||
  Method saith: put .[down the] embankment's
  upper width, three rods, .[and the]
  lower width, five rods.
  Combining them, resulteth in eight rods.
  Halving it, resulteth in four rods.
>>
====
* 法：
    method \+
    <@> Version~B | [version-b.url]155 | [version-b.h] </@>
    and
    <@> Version~C | [version-c.url]52180 | [version-c.h] </@>
    have the usual 術 for 法.

====

<<
  以高二丈乘之，得八百尺。以長六十尺乘之，得四萬八千。
||
  Multiplying it by .[the] height, two rods,
  resulteth in eight hundred rules.
  Multiplying it by .[the] length, sixty rules,
  resulteth in forty-eight thousand.
>>
====
* 
    <@> Version~B | [version-b.url]155 | [version-b.h] </@>
    has the  以二丈 for 以高二丈.

====

<<
  以一千尺除之，即得。
||
  Dividing it by one thousand rules,
  .[we] are done.
>>

----
  In modern notation, the volume of a trapezoidal prism of
    upper width $A = 3 \unit{rods}$,
    lower width $B = 5 \unit{rods}$,
    height $H = 2 \unit{rods}$ and
    length $L = 60 \unit{rules}$ is
----
$$
  \begin{aligned}
    V
    &= \frac{A + B}{2} \cdot H L \\[2ex]
    &=
      \frac{30 \unit{rules} + 50 \unit{rules}}{2}
        \times
      20 \unit{rules} \times 60 \unit{rules}
        \div
      \frac{1000 \unit{rules}^3}{\unit{block}} \\[2ex]
    &= 48 \unit{blocks}.
  \end{aligned}
$$

<;sh> 2 | 18 | Volume of a rectangular prism </;sh>
<;s@@> 2 | 18 | 38 | 155 | 52183 | 18 | 51 </;s@@>

<<
  今有溝，廣十丈，深五丈，長二十丈，欲以千尺作一方。問得幾何？
||
  Now there be .[a] ditch, of
    width ten rods,
    depth five rods, .[and]
    length twenty rods,
  .[and we] wish to consider
    .[a] thousand rules
  as one block.
  .[We] ask: how many result?
>>

<<
  答曰：一千方。
||
  Answer saith: one thousand blocks.
>>

<<
  術曰：置廣一十丈。以深五丈乘之，得五千尺。又以長二十丈乘之，得一百萬尺。
||
  Method saith: put .[down the] width, ten rods.
  Multiplying it by .[the] depth, five rods,
  resulteth in five thousand rules.
  Also multiplying it by .[the] length, twenty rods,
  resulteth in one million rules.
>>

<<
  以一千除之，即得。
||
  Dividing it by one thousand, .[we] are done.
>>

----
  In modern notation, the volume of a rectangular prism of
  width $W = 10 \unit{rods}$, depth $H = 5 \unit{rods}$ and
  length $L = 20 \unit{rods}$ is
----
$$
  \begin{aligned}
    V
    &= W H L \\
    &=
      100 \unit{rules} \times 50 \unit{rules} \times 200 \unit{rules}
        \div
      \frac{1000 \unit{rules}^3}{\unit{block}} \\[2ex]
    &= 1000 \unit{blocks}.
  \end{aligned}
$$

<;sh> 2 | 19 | Rod calculus: square root algorithm </;sh>
<;s@@> 2 | 19 | 40 | 156 | 52186 | 19 | 52 </;s@@>

<<
  今有積二十三萬四千五百六十七步。問為方幾何？
||
  Now there be area,
  two hundred .[and] thirty-four thousand, five hundred .[and] sixty-seven\ paces.
  .[We] ask: be .[this a] square .[of edge] how much?
>>

<<
  答曰：四百八十四步九百六十八分步之三百一十一。
||
  Answer saith:
    four hundred .[and] eighty-four paces
    .[and] three hundred .[and] eleven
      nine hundred .[and] sixty-eighths
    of .[a] pace.
>>

----
  Here we have an algorithm for computing the square root,
  in this instance giving
----
$$
  \sqrt{234567 \unit{paces}^2} \approx 484 \tfrac{311}{968} \unit{paces}.
$$

<<
  術曰：<:b>置積</:b>二十三萬四千五百六十七步為<:b>實</:b>。
||
  Method saith: <:b>put .[down the] area</:b>,
  two hundred .[and] thirty-four thousand, five hundred .[and] sixty-seven\ paces,
  as <:b>{the} dividend</:b>.
>>
----
  The radicand is called the <:b>__dividend__~(實)</:b>,
----
$$
  {\colb d} := {\colb 234567}.
$$

<!--
  For the square root algorithm SVGs:
    Roman variable names shall be at x = -3;
    Chinese names shall be at x = -1;
    Digits shall at x = 1, 2, 3, ..., 6.
  -->

<% [font-size-para-sqrt] | font-size="0.8" %>
<% [font-size-para-sqrt-sub] | font-size="0.5" %>

<% [#arrowhead] | marker-end="url(#arrowhead)" %>

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -0.25 10.5 2">
  <!-- d -->
  <text [mathit-b] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text class="blue" x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 234567 -->
  <text class="blue" x="1" y="1" [font-size-para-sqrt]>2</text>
  <text class="blue" x="2" y="1" [font-size-para-sqrt]>3</text>
  <text class="blue" x="3" y="1" [font-size-para-sqrt]>4</text>
  <text class="blue" x="4" y="1" [font-size-para-sqrt]>5</text>
  <text class="blue" x="5" y="1" [font-size-para-sqrt]>6</text>
  <text class="blue" x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="0" width="9" height="1.5"/>
</svg>
</div>

<<
  次<:r>借一算為下法</:r>。<:r>步之，超一位，至百而止</:r>。
||
  Next, <:r>borrow one rod, .[to] be .[the] lower divisor</:r>.
  <:r>Step it .[forth], jumping over one place,
  .[even] unto .[the] hundreds, and stop</:r>.
>>
====
* 超：跳也；
    jumping over;
    \or skipping \+
    Taking double steps, so that 100 is in fact 10000.

====
----
  Since the number of digits of the radicand is
----
$$
  N := \lfloor \log_{10} d \rfloor + 1 = 6,
$$
----
  the number of digits of the integer part of its square root is
----
$$
  n := \left\lceil \frac{N}{2} \right\rceil = 3.
$$
----
  We then take $n - 1 = 2$ double steps
  for the <:r>__lower divisor__~(下法)</:r>
----
$$
  {\colr L} := (10 ^ {n - 1}) ^ 2 = {\colr 10^4}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -0.25 10.5 3">
  <!-- Marker definitions -->
  <defs>
    <!-- Arrowhead -->
    <marker id="arrowhead" viewBox="0 -0.15 0.7 0.3"
      refX="0.5" refY="0"
      markerWidth="0.7" markerHeight="0.15"
      orient="auto-start-reverse">
      <path d="M 0,-0.15 L 0,0.15 L 0.7,0 z"/>
    </marker>
  </defs>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 234567 -->
  <text x="1" y="1" [font-size-para-sqrt]>2</text>
  <text x="2" y="1" [font-size-para-sqrt]>3</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- L -->
  <text [mathit-r] x="-3" y="2" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text class="red" x="-1" y="2" [font-size-para-sqrt]>\下法</text>
  <!-- 10000 -->
  <text class="red" x="2" y="2" [font-size-para-sqrt]>1</text>
  <!-- 步之，超一位，至百而止。 -->
  <path class="step" d="M 6 2 m -0.1 -0.3 a 2 2 0 0 0 -1.7 0" [#arrowhead]/>
  <path class="step" d="M 4 2 m -0.1 -0.3 a 2 2 0 0 0 -1.5 0" [#arrowhead]/>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="0" width="9" height="2.5"/>
</svg>
</div>

<<
  <:g>上商置四百</:g>於實之上。
||
  <:g>{For the} upper quotient,
  put four hundred</:g> above .[the] dividend.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]40 | [version-a.h] </@>
    and~\
    <@>
      C | [version-c.url]52186 | [version-c.h] </@>
    have just 商 for 上商.

* 上商：
    upper quotient \+
    The integer part of the square root to be computed.

====

----
  The <:g>__hundreds digit of the upper quotient__~(上商)</:g>
  is the largest $\colg a_1$ such that
  ${\colg a_1}^2 {\colr L} \le {\colb d}$,
  or
----
$$
  {\colr 10000} {\colg a_1}^2 \le {\colb 234567},
$$
----
  i.e.
----
$$
  {\colg a_1} := {\colg 4}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 5">
  <!-- 上商 -->
  <text class="green" x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit-g] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text class="green" x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 234567 -->
  <text x="1" y="1" [font-size-para-sqrt]>2</text>
  <text x="2" y="1" [font-size-para-sqrt]>3</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- L -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\下法</text>
  <!-- 10000 -->
  <text x="2" y="2" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="3.5"/>
</svg>
</div>

<<
  副<:v>置四萬</:v>於實之下，下法之上，名為<:v>方法</:v>。
||
  Subsidiarily <:v>put forty thousand</:v>
  below .[the] dividend, .[and] above .[the] lower divisor;
  .[its] name be <:v>{the} upright divisor</:v>.
>>
====
* 方：
    (morally) upright \+
    方法 is one of three named divisors whose names relate to integrity:
    ====
    * 方法： upright divisor ($s_1$)</li>
    * 廉法： incorrupt divisor ($s_2$)</li>
    * 隅法： honest divisor ($s_3$)</li>
    ====
    These shall henceforth be referred to as the __straight divisors__
    (straight as in 'straight copper' vs 'bent copper').

====

----
  The first straight divisor is the <:v>__upright divisor__~(方法)</:v>
----
$$
  {\colv s_1}
  := {\colg a_1} {\colr L}
  = {\colg 4} \times {\colr 10000}
  = {\colv 40000}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 6">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 234567 -->
  <text x="1" y="1" [font-size-para-sqrt]>2</text>
  <text x="2" y="1" [font-size-para-sqrt]>3</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit-v] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 方法 -->
  <text class="violet" x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 40000 -->
  <text class="violet" x="2" y="2" [font-size-para-sqrt]>4</text>
  <!-- L -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\下法</text>
  <!-- 10000 -->
  <text x="2" y="3" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="4.5"/>
</svg>
</div>

<<
  <:g>命上商四百</:g><:b>除實</:b>。
||
  <:g>Name .[the] upper quotient's four hundred</:g>,
  <:b>{and} remove .[this] from .[the] dividend</:b>.
>>
====
* 除：
    remove .[this] from \+
    This is also the word for division. Division was thought of as
    repeatedly removing the divisor from the dividend.

====

----
  As written, the text says
  ${\colb d} := {\colb d} - {\colg 400^2}$,
  but for the purpose of understanding how this step fits in with the others,
  this is best written
----
$$
  \begin{aligned}
    {\colb d}
    &:= {\colb d} - {\colg a_1} {\colv s_1} \\
    &= {\colb 234567} - {\colg 4} \times {\colv 40000} \\
    &= {\colb 74567}.
  \end{aligned}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 6">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit-b] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 74567 -->
  <text class="blue" x="2" y="1" [font-size-para-sqrt]>7</text>
  <text class="blue" x="3" y="1" [font-size-para-sqrt]>4</text>
  <text class="blue" x="4" y="1" [font-size-para-sqrt]>5</text>
  <text class="blue" x="5" y="1" [font-size-para-sqrt]>6</text>
  <text class="blue" x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 40000 -->
  <text x="2" y="2" [font-size-para-sqrt]>4</text>
  <!-- L -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\下法</text>
  <!-- 10000 -->
  <text x="2" y="3" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="4.5"/>
</svg>
</div>

<<
  除訖，<:v>倍方法</:v>。
||
  .[The] removal finished, <:v>double .[the] upright divisor</:v>.
>>

$$
  {\colv s_1} := 2 s_1 = 2 \times 40000 = {\colv 80000}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 6">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 74567 -->
  <text x="2" y="1" [font-size-para-sqrt]>7</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit-v] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 方法 -->
  <text class="violet" x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 80000 -->
  <text class="violet" x="2" y="2" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\下法</text>
  <!-- 10000 -->
  <text x="2" y="3" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="4.5"/>
</svg>
</div>

<<
  <:v>方法一退</:v>，<:r>下法再退</:r>。
||
  <:v>{The} upright divisor retreateth once</:v>;
  <:r>{the} lower divisor retreateth again</:r>.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]40 | [version-a.h] </@>
    and~\
    <@>
      C | [version-c.url]52186 | [version-c.h] </@>
    are missing 方法 in 方法一退.

* 再：
    again;
    \or twice

====

$$
  \begin{aligned}
    {\colv s_1} &:= s_1 / 10 = 80000 / 10 = {\colv 8000} \\
    {\colr L} &:= L / 10^2 = 10000 / 100 = {\colr 100}
  \end{aligned}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 6">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 74567 -->
  <text x="2" y="1" [font-size-para-sqrt]>7</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit-v] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 方法 -->
  <text class="violet" x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 8000 -->
  <text class="violet" x="3" y="2" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit-r] x="-3" y="3" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text class="red" x="-1" y="3" [font-size-para-sqrt]>\下法</text>
  <!-- 100 -->
  <text class="red" x="4" y="3" [font-size-para-sqrt]>1</text>
  <!-- 方法一退 -->
  <path class="step" d="M 2 2 m -0.1 -0.3 a 1.5 2 0 0 1 0.7 0" [#arrowhead]/>
  <!-- 下法再退 -->
  <path class="step" d="M 2 3 m -0.1 -0.3 a 2 2 0 0 1 1.7 0" [#arrowhead]/>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="4.5"/>
</svg>
</div>

<<
  復<:g>置上商八十</:g>，以次前商。
||
  <:g>Put</:g> again <:g>{for the} upper quotient eighty</:g>,
  to be next .[after the] quotient .[digit] before.
>>

----
  The <:g>__tens digit of the upper quotient__~(上商)</:g>
  is the largest $\colg a_2$ such that
  ${\colg a_2} ({\colv s_1} + {\colg a_2} {\colr L}) \le {\colb d}$,
  or
----
$$
  {\colg a_2} ({\colv 8000} + {\colr 100} {\colg a_2}) \le {\colb 74567},
$$
----
  i.e.
----
$$
  {\colg a_2} := {\colg 8}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 6">
  <!-- 上商 -->
  <text class="green" x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit-g] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text class="green" x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 74567 -->
  <text x="2" y="1" [font-size-para-sqrt]>7</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 8000 -->
  <text x="3" y="2" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\下法</text>
  <!-- 100 -->
  <text x="4" y="3" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="4.5"/>
</svg>
</div>

<<
  副<:v>置八百</:v>於方法之下，下法之上，名為<:v>廉法</:v>。
||
  Subsidiarily <:v>put eight hundred</:v>
  below .[the] upright divisor, .[and] above .[the] lower divisor;
  .[its] name be <:v>{the} incorrupt divisor</:v>.
>>
====
* 廉：
    incorrupt

====

----
  The second straight divisor is the <:v>__incorrupt divisor__~(廉法)</:v>
----
$$
  {\colv s_2}
  := {\colg a_2} {\colr L}
  = {\colg 8} \times {\colr 100}
  = {\colv 800}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 7">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 74567 -->
  <text x="2" y="1" [font-size-para-sqrt]>7</text>
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>5</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit-v] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 8000 -->
  <text x="3" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text class="violet" x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 800 -->
  <text class="violet" x="4" y="3" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit] x="-3" y="4" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="4" [font-size-para-sqrt]>\下法</text>
  <!-- 100 -->
  <text x="4" y="4" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="5.5"/>
</svg>
</div>

<<
  <:v>方、廉各命</:v><:g>上商八十</:g>，以<:b>除實</:b>。
||
  <:v>Each of .[the] upright .[and the] incorrupt nameth</:v>
  <:g>{the} upper quotient's eighty</:g>,
  to be <:b>removed from .[the] dividend</:b>.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]40 | [version-a.h] </@>
    and~\
    <@>
      C | [version-c.url]52186 | [version-c.h] </@>
    are missing 實.

====

$$
  \begin{aligned}
    {\colb d}
    &:= {\colb d} - {\colg a_2} {\colv (s_1 + s_2)} \\
    &= {\colb 74567} - {\colg 8} \times {\colv (8000 + 800)} \\
    &= {\colb 4167}
  \end{aligned}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 7">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- d -->
  <text [mathit-b] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text class="blue" x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 4167 -->
  <text class="blue" x="3" y="1" [font-size-para-sqrt]>4</text>
  <text class="blue" x="4" y="1" [font-size-para-sqrt]>1</text>
  <text class="blue" x="5" y="1" [font-size-para-sqrt]>6</text>
  <text class="blue" x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 8000 -->
  <text x="3" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 800 -->
  <text x="4" y="3" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit] x="-3" y="4" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="4" [font-size-para-sqrt]>\下法</text>
  <!-- 100 -->
  <text x="4" y="4" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="5.5"/>
</svg>
</div>

<<
  除訖，<:v>倍廉法</:v>，上從方法。
||
  .[The] removal finished, <:v>double .[the] incorrupt divisor</:v>,
  .[which] followeth .[the] upright divisor above.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]40 | [version-a.h] </@>
    and~\
    <@>
      C | [version-c.url]52186 | [version-c.h] </@>
    are missing 除.

====

$$
  {\colv s_2} := 2 s_2 = 2 \times 800 = {\colv 1600}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 7">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 4167 -->
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>1</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit-v] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 8000 -->
  <text x="3" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text class="violet" x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 1600 -->
  <text class="violet" x="3" y="3" [font-size-para-sqrt]>1</text>
  <text class="violet" x="4" y="3" [font-size-para-sqrt]>6</text>
  <!-- L -->
  <text [mathit] x="-3" y="4" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="4" [font-size-para-sqrt]>\下法</text>
  <!-- 100 -->
  <text x="4" y="4" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="5.5"/>
</svg>
</div>

<<
  <:v>方法一退</:v>，<:r>下法再退</:r>。
||
  <:v>{The} upright divisor retreateth once</:v>;
  <:r>{the} lower divisor retreateth again</:r>.
>>
====
* 
    <@> Version~A | [version-a.url]40 | [version-a.h] </@>
    erroneously has 一退方法 for 方法一退.

* 
    Presumably 上從方法 from the previous sentence tells us that
    the incorrupt divisor~(廉法) is to
      "follow .[the] upright divisor~(方法) above"
    in its retreat.

====

$$
  \begin{aligned}
    {\colv s_1} &:= s_1 / 10 = 8000 / 10 = {\colv 800} \\
    {\colv s_2} &:= s_2 / 10 = 1600 / 10 = {\colv 160} \\
    {\colr L} &:= L / 10^2 = 100 / 100 = {\colr 1}
  \end{aligned}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 7">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 4167 -->
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>1</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit-v] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit-v] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 方法 -->
  <text class="violet" x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text class="violet" x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text class="violet" x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text class="violet" x="4" y="3" [font-size-para-sqrt]>1</text>
  <text class="violet" x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- L -->
  <text [mathit-r] x="-3" y="4" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text class="red" x="-1" y="4" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text class="red" x="6" y="4" [font-size-para-sqrt]>1</text>
  <!-- 方法一退 -->
  <path class="step" d="M 3 2 m -0.1 -0.3 a 1.5 2 0 0 1 0.7 0" [#arrowhead]/>
  <path class="step" d="M 3 3 m -0.1 -0.3 a 1.5 2 0 0 1 0.7 0" [#arrowhead]/>
  <!-- 下法再退 -->
  <path class="step" d="M 4 4 m -0.1 -0.3 a 2 2 0 0 1 1.7 0" [#arrowhead]/>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="5.5"/>
</svg>
</div>

<<
  復<:g>置上商四</:g>，以次前。
||
  <:g>Put</:g> again <:g>{for the} upper quotient four</:g>,
  to be next .[after the digit] before.
>>

----
  The <:g>__ones digit of the upper quotient__~(上商)</:g>
  is the largest $\colg a_3$ such that
  ${\colg a_3} ({\colv s_1} + {\colv s_2} + {\colg a_3} {\colr L})
  \le {\colb d}$,
  or
----
$$
  {\colg a_3} ({\colv 800} + {\colv 160} + {\colg a_3}) \le {\colb 4167},
$$
----
  i.e.
----
$$
  {\colg a_3} := {\colg 4}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 7">
  <!-- 上商 -->
  <text class="green" x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- a_3 -->
  <text [mathit-g] x="6" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 4 -->
  <text class="green" x="6" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 4167 -->
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>1</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text x="4" y="3" [font-size-para-sqrt]>1</text>
  <text x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- L -->
  <text [mathit] x="-3" y="4" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="4" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text x="6" y="4" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="5.5"/>
</svg>
</div>

<<
  副<:v>置四</:v>於方法之下，下法之上，名曰<:v>隅法</:v>。
||
  Subsidiarily <:v>put four</:v>
  below .[the] upright divisor, .[and] above .[the] lower divisor;
  .[its] name .[be] called <:v>{the} honest divisor</:v>.
>>
====
* 隅：廉也；
    honest

====

----
  The third straight divisor is the <:v>__honest divisor__~(隅法)</:v>
----
$$
  {\colv s_3}
  := {\colg a_3} {\colr L}
  = {\colg 4} \times {\colr 1}
  = {\colv 4}.
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 8">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- a_3 -->
  <text [mathit] x="6" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 4 -->
  <text x="6" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 4167 -->
  <text x="3" y="1" [font-size-para-sqrt]>4</text>
  <text x="4" y="1" [font-size-para-sqrt]>1</text>
  <text x="5" y="1" [font-size-para-sqrt]>6</text>
  <text x="6" y="1" [font-size-para-sqrt]>7</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- s_3 -->
  <text [mathit-v] x="-3" y="4" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text x="4" y="3" [font-size-para-sqrt]>1</text>
  <text x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- 隅法 -->
  <text class="violet" x="-1" y="4" [font-size-para-sqrt]>\隅法</text>
  <!-- 4 -->
  <text class="violet" x="6" y="4" [font-size-para-sqrt]>4</text>
  <!-- L -->
  <text [mathit] x="-3" y="5" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="5" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text x="6" y="5" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="6.5"/>
</svg>
</div>

<<
  <:v>方、廉、隅各命</:v><:g>上商四</:g>，以<:b>除實</:b>。
||
  <:v>Each of .[the] upright, .[the] incorrupt .[and the] honest nameth</:v>
  <:g>{the} upper quotient's four</:g>,
  to be <:b>removed from .[the] dividend</:b>.
>>
====
* 
    <@> Version~A | [version-a.url]40 | [version-a.h] </@>
    is missing 以.

====

$$
  \begin{aligned}
    {\colb d}
    &:= {\colb d} - {\colg a_3} {\colv (s_1 + s_2 + s_3)} \\
    &= {\colb 4167} - {\colg 4} \times {\colv (800 + 160 + 4)} \\
    &= {\colb 311}
  \end{aligned}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 8">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- a_3 -->
  <text [mathit] x="6" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 4 -->
  <text x="6" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit-b] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text class="blue" x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 311 -->
  <text class="blue" x="4" y="1" [font-size-para-sqrt]>3</text>
  <text class="blue" x="5" y="1" [font-size-para-sqrt]>1</text>
  <text class="blue" x="6" y="1" [font-size-para-sqrt]>1</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- s_3 -->
  <text [mathit] x="-3" y="4" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text x="4" y="3" [font-size-para-sqrt]>1</text>
  <text x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- 隅法 -->
  <text x="-1" y="4" [font-size-para-sqrt]>\隅法</text>
  <!-- 4 -->
  <text x="6" y="4" [font-size-para-sqrt]>4</text>
  <!-- L -->
  <text [mathit] x="-3" y="5" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="5" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text x="6" y="5" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="6.5"/>
</svg>
</div>

<<
  除訖，<:v>倍隅法</:v>，從方法。
||
  .[The] removal finished, <:v>double .[the] honest divisor</:v>,
  .[which] followeth .[the] upright divisor.
>>
====
* 
    <@> Version~A | [version-a.url]40 | [version-a.h] </@>
    is missing 倍隅法，從方法.

====

$$
  {\colv s_3} := 2 s_3 = 2 \times 4 = {\colv 8}
$$

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 8">
  <!-- 上商 -->
  <text x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- a_3 -->
  <text [mathit] x="6" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 4 -->
  <text x="6" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 311 -->
  <text x="4" y="1" [font-size-para-sqrt]>3</text>
  <text x="5" y="1" [font-size-para-sqrt]>1</text>
  <text x="6" y="1" [font-size-para-sqrt]>1</text>
  <!-- s_1 -->
  <text [mathit] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- s_3 -->
  <text [mathit-v] x="-3" y="4" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 方法 -->
  <text x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text x="4" y="3" [font-size-para-sqrt]>1</text>
  <text x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- 隅法 -->
  <text class="violet" x="-1" y="4" [font-size-para-sqrt]>\隅法</text>
  <!-- 8 -->
  <text class="violet" x="6" y="4" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit] x="-3" y="5" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text x="-1" y="5" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text x="6" y="5" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="6.5"/>
</svg>
</div>

<<
  <:g>上商得四百八十四</:g>，\
  <:v>下法得九百六十八</:v>，\
  <:b>不盡三百一十一</:b>。
||
  <:g>{The} upper quotient resulteth in
    four hundred .[and] eighty-four</:g>,
  <:v>{and the} lower divisors result in
    nine hundred .[and] sixty-eight</:v>,
  <:b>{with} remainder
    three hundred .[and] eleven</:b>.
>>
====
* 下法：
    lower divisors \+
    Confusingly, this refers not to the lower divisor~(下法),
    currently $\colr L = 1$,
    but to the total of the three straight divisors,
      upright ($\colv s_1$),
      incorrupt ($\colv s_2$) and
      honest ($\colv s_3$).

====

$$
  \begin{aligned}
    {\colg U} &:= {\colg 100 a_1 + 10 a_2 + a_3} = {\colg 484} \\
    {\colv L} &:= {\colv s_1 + s_2 + s_3} = {\colv 968} \\
    {\colb R} &:= {\colb d} = {\colb 311}
  \end{aligned}
$$

----
  The final arrangement of counting rods is thus:
----

<div class="centred-svg">
<svg class="fit-width tight" width="280px" viewBox="-3.5 -2.25 10.5 8">
  <!-- 上商 -->
  <text class="green" x="-1" y="0" [font-size-para-sqrt]>\上商</text>
  <!-- a_1 -->
  <text [mathit-g] x="4" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- 4 -->
  <text class="green" x="4" y="0" [font-size-para-sqrt]>4</text>
  <!-- a_2 -->
  <text [mathit-g] x="5" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- 8 -->
  <text class="green" x="5" y="0" [font-size-para-sqrt]>8</text>
  <!-- a_3 -->
  <text [mathit-g] x="6" y="-1.3" [font-size-para-sqrt]>\
    a<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 4 -->
  <text class="green" x="6" y="0" [font-size-para-sqrt]>4</text>
  <!-- d -->
  <text [mathit-b] x="-3" y="1" [font-size-para-sqrt]>d</text>
  <!-- 實 -->
  <text class="blue" x="-1" y="1" [font-size-para-sqrt]>\實</text>
  <!-- 311 -->
  <text class="blue" x="4" y="1" [font-size-para-sqrt]>3</text>
  <text class="blue" x="5" y="1" [font-size-para-sqrt]>1</text>
  <text class="blue" x="6" y="1" [font-size-para-sqrt]>1</text>
  <!-- s_1 -->
  <text [mathit-v] x="-3" y="2" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">1</tspan>\
  </text>
  <!-- s_2 -->
  <text [mathit-v] x="-3" y="3" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">2</tspan>\
  </text>
  <!-- s_3 -->
  <text [mathit-v] x="-3" y="4" [font-size-para-sqrt]>\
    s<tspan [font-size-para-sqrt-sub] dy="0.25em">3</tspan>\
  </text>
  <!-- 方法 -->
  <text class="violet" x="-1" y="2" [font-size-para-sqrt]>\方法</text>
  <!-- 800 -->
  <text class="violet" x="4" y="2" [font-size-para-sqrt]>8</text>
  <!-- 廉法 -->
  <text class="violet" x="-1" y="3" [font-size-para-sqrt]>\廉法</text>
  <!-- 160 -->
  <text class="violet" x="4" y="3" [font-size-para-sqrt]>1</text>
  <text class="violet" x="5" y="3" [font-size-para-sqrt]>6</text>
  <!-- 隅法 -->
  <text class="violet" x="-1" y="4" [font-size-para-sqrt]>\隅法</text>
  <!-- 8 -->
  <text class="violet" x="6" y="4" [font-size-para-sqrt]>8</text>
  <!-- L -->
  <text [mathit-r] x="-3" y="5" [font-size-para-sqrt]>L</text>
  <!-- 下法 -->
  <text class="red" x="-1" y="5" [font-size-para-sqrt]>\下法</text>
  <!-- 1 -->
  <text class="red" x="6" y="5" [font-size-para-sqrt]>1</text>
  <!-- Rectangular border -->
  <rect class="border" x="-2.25" y="-1" width="9" height="6.5"/>
</svg>
</div>

<<
  是為方<:g>四百八十四</:g>步<:v>九百六十八分</:v>步之<:b>三百一十一</:b>。
||
  This be .[a] square .[of edge]
    <:g>four hundred .[and] eighty-four</:g> paces
    .[and] <:b>three hundred .[and] eleven</:b>
      <:v>nine hundred .[and] sixty-eighths</:v>
    of .[a] pace.
>>

----
  Thus the algorithm gives
----
$$
  \begin{aligned}
    \sqrt{234567 \unit{paces}^2}
    &\approx \left( {\colg U} + \frac{\colb R}{\colv L} \right) \unit{paces} \\
    &= {\colg 484} \tfrac{\colb 311}{\colv 968} \unit{paces},
  \end{aligned}
$$
----
  which has relative error $2.2 \times 10^{-7}$.
----

<@4>
  Summary of [sun-tzu]'s square root algorithm
  | sqrt
</@4>

----
  In general, to compute the square root of the positive integer $x$:
----
<ol class="sparse-list">
* 
    Compute the number of digits of $x$:
    $$
      N := \lfloor \log_{10} x \rfloor + 1
    $$

* 
    Compute the number of digits of the <:g>upper quotient~(上商)</:g>,
    which is the integer part of $\sqrt{x}$:
    $$
      n := \left\lceil \frac{N}{2} \right\rceil
    $$

* 
    Initialise the <:r>lower divisor~(下法)</:r>:
    $$
      {\colr L} := (10 ^ {n - 1}) ^ 2
    $$

* 
    Initialise the <:b>dividend~(實)</:b>:
    $$
      {\colb d} := x
    $$

* 
    <span class="small-caps">For</span> $i = 1, 2, \dots, n$:
    <ul class="sparse-list">
    * 
        Determine the <:g>$i$th digit of the upper quotient~(上商)</:g>,
        the largest integer $\colg a_i$ such that
        $$
          {\colg a_i} [
            ({\colv s_1} + \dots + {\colv s_{i-1}})
            + {\colg a_i} {\colr L}
          ] \le {\colb d}.
        $$
    
    * 
        Determine the <:v>$i$th straight divisor</:v>:
        $$
          {\colv s_i} := {\colg a_i} {\colr L}
        $$
        
----
          (The first three are named:
            $\colv s_1$ upright~(方),
            $\colv s_2$ incorrupt~(廉), and
            $\colv s_3$ honest~(隅).\
          )
        
----
    
    * 
        Update the <:b>dividend~(實)</:b>:
        $$
          {\colb d} :=
          {\colb d} - {\colg a_i} [
            ({\colv s_1} + \dots + {\colv s_{i-1}})
            + {\colv s_i}
          ]
        $$
    
    * 
        Double the <:v>$i$th straight divisor</:v>:
        $$
          {\colv s_i} := 2 s_i
        $$
    
    * 
        <span class="small-caps">If</span> $i < n$:
        ====
        * 
            Retreat the divisors:
            $$
              \begin{aligned}
                {\colv s_1} &:= s_1 / 10 \\
                            &\quad \vdots \\
                {\colv s_i} &:= s_i / 10 \\
                {\colr L}   &:= L / 10^2
              \end{aligned}
            $$
        
        ====
        <span class="small-caps">End~If</span>
    
    ====
    <span class="small-caps">End~For</span>

* 
    Compute
      the <:g>upper quotient~(上商)</:g>,
      the <:v>sum of the straight divisors</:v>,
      and the <:b>remainder~(不盡)</:b>:
    $$
      \begin{aligned}
        {\colg U} &:= {\colg 10^{n-1} a_1 + 10^{n-2} a_2 + \dots + a_n} \\
        {\colv L} &:= {\colv s_1 + s_2 + \dots + s_n} \\
        {\colb R} &:= {\colb d}
      \end{aligned}
    $$

* 
    <span class="small-caps">Return</span>
    ${\colg U} + {\colb R} / {\colv L}$.

</ol>
----
  For an implementation in Python, see
  <@>
    <`>/sun-tzu/code/sqrt.py</`>
    | \/sun-tzu/code/sqrt.py
    | Python: [sun-tzu] square root algorithm
  </@>.
----

<;sh> 2 | 20 | Rod calculus: square root algorithm </;sh>
<;s@@> 2 | 20 | 42 | 156 | 52189 | 20 | 54 </;s@@>

<<
  今有積三萬五千步。問為圓幾何？
||
  Now there be area,
  thirty-five thousand paces.
  .[We] ask: be .[this a] circle .[of circumference] how much?
>>

<<
  答曰：六百四十八步一千二百九十六分步之九十六。
||
  Answer saith:
    six hundred .[and] forty-eight paces
    .[and] ninety-six
      one thousand, two hundred .[and] ninety-sixths
    of .[a] pace.
>>

<<
  術曰：置積三萬五千步。以一十二乘之，得四十二萬為<:b>實</:b>。
||
  Method saith: put .[down the] area,
    thirty-five thousand paces.
  Multiplying it by twelve, resulteth in
    four hundred .[and] twenty thousand
  as <:b>{the} dividend</:b>.
>>
====
* 
    <@> Version~C | [version-c.url]52189 | [version-c.h] </@>
    has 四十二萬步 for 四十二萬.

====

----
  In modern notation
  (but taking $\pi \approx 3$ i.e. $4\pi \approx 12$
  as per <@> Vol.~I \P5 | /sun-tzu/i#5 | </@>),
  the circumference of a circle of area $A = 35000 \unit{paces}^2$ is
----
$$
  \begin{aligned}
    C &\approx \sqrt{12 A} \\
      &= \sqrt{420000} \unit{paces}.
  \end{aligned}
$$
----
  The balance of this paragraph involves extracting the square root of~420000.
  For a fully annotated and diagrammed walkthrough of
  [sun-tzu]'s square root algorithm,
  see the previous <@> \P19 | /sun-tzu/ii#19 | Vol.~II \P19 </@>
  and the
  <@>
    pseudocode summary
    | #sqrt
    | Summary of [sun-tzu]'s square root algorithm
  </@>,
  whose detail I will not be repeating here.
----

<<
  次<:r>借一算為下法</:r>。<:r>步之，超一位，至百而止</:r>。
||
  Next, <:r>borrow one rod, .[to] be .[the] lower divisor</:r>.
  <:r>Step it .[forth], jumping over one place,
  .[even] unto .[the] hundreds, and stop</:r>.
>>

<<
  <:g>上商置六百</:g>於實之上。
||
  <:g>{For the} upper quotient,
  put six hundred</:g> above .[the] dividend.
>>
====
* 
    <@> Version~A | [version-a.url]42 | [version-a.h] </@>
    erroneously has 餘於 for 於.

====

<<
  副<:v>置六萬</:v>於實之下，下法之上，名為<:v>方法</:v>。
||
  Subsidiarily <:v>put sixty thousand</:v>
  below .[the] dividend, .[and] above .[the] lower divisor;
  .[its] name be <:v>{the} upright divisor</:v>.
>>

<<
  <:g>命上商六百</:g><:b>除實</:b>。
||
  <:g>Name .[the] upper quotient's six hundred</:g>,
  <:b>{and} remove .[this] from .[the] dividend</:b>.
>>

<<
  除訖，<:v>倍方法</:v>。
||
  .[The] removal finished, <:v>double .[the] upright divisor</:v>.
>>

<<
  <:v>方法一退</:v>，<:r>下法再退</:r>。
||
  <:v>{The} upright divisor retreateth once</:v>;
  <:r>{the} lower divisor retreateth again</:r>.
>>

<<
  復<:g>置上商四十</:g>，以次前商。
||
  <:g>Put</:g> again <:g>{for the} upper quotient forty</:g>,
  to be next .[after the] quotient .[digit] before.
>>

<<
  副<:v>置四百</:v>於方法之下，下法之上，名為<:v>廉法</:v>。
||
  Subsidiarily <:v>put four hundred</:v>
  below .[the] upright divisor, .[and] above .[the] lower divisor;
  .[its] name be <:v>{the} incorrupt divisor</:v>.
>>

<<
  <:v>方、廉各命</:v><:g>上商四十</:g>，以<:b>除實</:b>。
||
  <:v>Each of .[the] upright .[and the] incorrupt nameth</:v>
  <:g>{the} upper quotient's forty</:g>,
  to be <:b>removed from .[the] dividend</:b>.
>>
====
* 
    Versions~\
    <@>
      A | [version-a.url]42 | [version-a.h] </@>
    and~\
    <@>
      C | [version-c.url]52189 | [version-c.h] </@>
    are missing 四十 after 上商.

====

<<
  除訖，<:v>倍廉法</:v>，從方法。
||
  .[The] removal finished, <:v>double .[the] incorrupt divisor</:v>,
  .[which] followeth .[the] upright divisor.
>>

<<
  <:v>方法一退</:v>，<:r>下法再退</:r>。
||
  <:v>{The} upright divisor retreateth once</:v>;
  <:r>{the} lower divisor retreateth again</:r>.
>>

<<
  復<:g>置上商八</:g>，次前商。
||
  <:g>Put</:g> again <:g>{for the} upper quotient eight</:g>,
  next .[after the] quotient .[digit] before.
>>

<<
  副<:v>置八</:v>於方法之下，下法之上，名為<:v>隅法</:v>。
||
  Subsidiarily <:v>put eight</:v>
  below .[the] upright divisor, .[and] above .[the] lower divisor;
  .[its] name be <:v>{the} honest divisor</:v>.
>>

<<
  <:v>方、廉、隅各命</:v><:g>上商八</:g>，以<:b>除實</:b>。
||
  <:v>Each of .[the] upright, .[the] incorrupt .[and the] honest nameth</:v>
  <:g>{the} upper quotient's eight</:g>,
  to be <:b>removed from .[the] dividend</:b>.
>>
====
* 
    <@> Version~C | [version-c.url]52189 | [version-c.h] </@>
    erroneously has 上前 for 上商八.

====

<<
  除訖，<:v>倍隅法</:v>，從方法。
||
  .[The] removal finished, <:v>double .[the] honest divisor</:v>,
  .[which] followeth .[the] upright divisor.
>>

<<
  <:g>上商得六百四十八</:g>，\
  <:v>下法得一千二百九十六</:v>，\
  <:b>不盡九十六</:b>。
||
  <:g>{The} upper quotient resulteth in
    six hundred .[and] forty-eight</:g>,
  <:v>{and the} lower divisors result in
    one thousand, two hundred .[and] ninety-six</:v>,
  <:b>{with} remainder ninety-six</:b>.
>>
====
* 
    <@> Version~A | [version-a.url]42 | [version-a.h] </@>
    is missing 得 after 上商,
    and erroneously has 一千二百九十七 for 一千二百九十六 both here
    and in the line to follow.

====

<<
  是為方<:g>六百四十八</:g>步<:v>一千二百九十六分</:v>步之<:b>九十六</:b>。
||
  This be .[a] circumference of
    <:g>six hundred .[and] forty-eight</:g> paces
    .[and] <:b>ninety-six</:b>
      <:v>one thousand, two hundred .[and] ninety-sixths</:v>
    of .[a] pace.
>>


<div class="end">
  <:r>WORK IN PROGRESS</:r>
</div>

<*c>
  "[sun-tzu]'s Computational Classic: [vol-ii]"
  | sun-tzu-ii
  | ``{Sun}~{Tz{\uu}'s} .[Computational] .[Classic]: {[vol-ii]}''
</*c>

<*f></*f>
